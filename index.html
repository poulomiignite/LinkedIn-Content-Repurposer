<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Repurposer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- Import Map for React and Lucide -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0"
        }
    }
    </script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Copy, FileText, Instagram, Video, Loader2, AlertCircle, 
            Check, Sparkles, MonitorPlay, SlidersHorizontal, 
            Image as ImageIcon, Download, Type, Mail, BookOpen, Key 
        } from 'lucide-react';

        const ContentRepurposer = () => {
            // --- CONFIGURATION ---
            // Your API Key is hardcoded here for convenience.
            // Do not share this file publicly while this key is present.
            const HARDCODED_KEY = "AIzaSyBXiBg18JOCYbA3dvNwBBgP_AdioIj-ew8";
            // ---------------------

            const [inputText, setInputText] = useState('');
            const [tweakPrompt, setTweakPrompt] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [output, setOutput] = useState(null);
            const [activeTab, setActiveTab] = useState('blog');
            const [copiedSection, setCopiedSection] = useState(null);
            const [generatingImages, setGeneratingImages] = useState({});
            const [generatedImages, setGeneratedImages] = useState({});

            const [userApiKey, setUserApiKey] = useState('');
            // If hardcoded key exists, we don't need to show the input screen
            const [showKeyInput, setShowKeyInput] = useState(!HARDCODED_KEY);

            useEffect(() => {
                if (HARDCODED_KEY) {
                    setShowKeyInput(false);
                    return;
                }
                const storedKey = localStorage.getItem('gemini_api_key');
                if (storedKey) {
                    setUserApiKey(storedKey);
                    setShowKeyInput(false);
                }
            }, []);

            const saveApiKey = (key) => {
                localStorage.setItem('gemini_api_key', key);
                setUserApiKey(key);
                setShowKeyInput(false);
            };

            const clearApiKey = () => {
                if (HARDCODED_KEY) {
                    alert("The API Key is hardcoded in this file. To change it, you must edit the HTML code.");
                    return;
                }
                localStorage.removeItem('gemini_api_key');
                setUserApiKey('');
                setShowKeyInput(true);
            };

            const getApiKey = () => {
                return HARDCODED_KEY || userApiKey;
            };

            const handleRepurpose = async () => {
                if (!inputText.trim()) return;
                
                const currentKey = getApiKey();
                if (!currentKey) {
                    setError("API Key is missing. Please enter your Google Gemini API Key.");
                    setShowKeyInput(true);
                    return;
                }

                setIsLoading(true);
                setError(null);
                setOutput(null);
                setGeneratedImages({});

                const prompt = `
                Act as an expert content marketer. Repurpose the following LinkedIn post into five distinct assets.
                
                CONSTRAINTS:
                - All output must have a Readability Grade Level of roughly 7 (simple, accessible English).
                - Tone: Professional yet conversational.
                ${tweakPrompt ? `- IMPORTANT USER REFINEMENT INSTRUCTION: ${tweakPrompt}` : ''}
                
                INPUT TEXT:
                "${inputText}"

                REQUIRED OUTPUTS:
                1. SEO Friendly Blog Post:
                    - A catchy, SEO-optimized title.
                    - A "visual_description" for a featured image (landscape format, premium photography concept).
                    - Content Requirements: Write a detailed, comprehensive blog post (800+ words).
                    - Formatting Rule: EXTREMELY IMPORTANT - Keep paragraphs very short (max 1-2 sentences per paragraph). This creates a fast-paced, highly readable rhythm.
                    - Bullets: Use bullet points where appropriate for lists, but do NOT format the entire post as bullets. Mix short, punchy paragraphs with occasional lists.
                    - Structure: Use proper Markdown H2 and H3 headings to organize the content logically.
                    - Voice: Write in the first person ("I"). Weave in personal storytelling, specific details, and deep insights based on the input text. Make it feel like a personal essay or expert guide, not a generic AI summary.
                    
                2. 3 Instagram Posts (Image Concept + Caption):
                    - Strategy: Pick a high-level benefit or a provoking question from the post to feature ON the image.
                    - "hook_text": The actual text to appear on the image (max 15 words). e.g., "Does your business run on autopilot or stress?"
                    - "visual_description": A description of the background aesthetics.
                    - "caption": A caption that explains the hook_text and expands on the concept (min 50 words).
                    
                3. Short Reel Script (60 seconds):
                    - Provide 5 eye-catching, viral-style titles/hooks for the video.
                    - The script itself must be strictly spoken words/dialogue ONLY.
                
                4. Email Newsletter:
                    - "subject": A high-open-rate subject line.
                    - "preview_text": Short preview text (preheader) for the inbox.
                    - "body": The newsletter content, personal and direct, driving value.

                5. Substack Notes (3 Specific Growth Types):
                    - Type 1 (Community): Invite participation. Ask a question, encourage others to share their story or link. (e.g., "What's your experience with X?").
                    - Type 2 (Educational): One simple, actionable insight. Not a full guide. Just one "Aha!" moment explained simply.
                    - Type 3 (Motivational): Encouragement about the journey. Permission to start/fail. Honest reflection.
                
                FORMAT:
                Return ONLY a valid JSON object with this exact structure:
                {
                    "blog": {
                    "title": "String",
                    "visual_description": "String",
                    "content": "String (Markdown format)"
                    },
                    "captions": [
                    { 
                        "hook_text": "String",
                        "visual_description": "String",
                        "caption": "String" 
                    },
                    { 
                        "hook_text": "String",
                        "visual_description": "String",
                        "caption": "String" 
                    },
                    { 
                        "hook_text": "String",
                        "visual_description": "String",
                        "caption": "String" 
                    }
                    ],
                    "script": {
                    "titles": ["String", "String", "String", "String", "String"],
                    "content": "String"
                    },
                    "email": {
                    "subject": "String",
                    "preview_text": "String",
                    "body": "String"
                    },
                    "substack_notes": {
                        "community": "String",
                        "educational": "String",
                        "motivational": "String"
                    }
                }
                `;

                try {
                    const data = await fetchWithBackoff(prompt, 5, 1000, currentKey);
                    const cleanText = data.replace(/```json/g, '').replace(/```/g, '').trim();
                    const parsedData = JSON.parse(cleanText);
                    setOutput(parsedData);
                    setActiveTab('blog');
                } catch (err) {
                    console.error("Error repurposing content:", err);
                    setError("Failed to generate content. Please try again. " + (err.message || ''));
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchWithBackoff = async (prompt, retries = 5, delay = 1000, apiKey) => {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`API Error: ${response.status} ${errorData.error?.message || ''}`);
                    }

                    const result = await response.json();
                    return result.candidates[0].content.parts[0].text;
                } catch (err) {
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithBackoff(prompt, retries - 1, delay * 2, apiKey);
                    }
                    throw err;
                }
            };

            const generateImage = async (item, index, type = 'social') => {
                const currentKey = getApiKey();
                if (!currentKey) {
                    setError("API Key missing for image generation.");
                    return;
                }

                const key = type === 'blog' ? 'blog' : index;
                if (generatingImages[key]) return;

                setGeneratingImages(prev => ({ ...prev, [key]: true }));
                
                let enhancedPrompt = '';
                
                if (type === 'blog') {
                    enhancedPrompt = `16:9 Landscape format blog featured image created by Nano Banana Pro. Subject: ${item.visual_description}. Style: Nano Banana Pro premium aesthetic, High-end, premium photography featuring diverse professionals or people in modern, soft-toned environments. Lighting: Soft, warm, natural, human-centric, not cold or clinical. Colors should be muted, premium, and sophisticated (no bold or garish colors). Cinematic depth of field, 4k resolution.`;
                } else {
                    enhancedPrompt = `Square format social media graphic created by Nano Banana Pro. Background: High-end, premium photography featuring diverse professionals or people in modern, soft-toned environments relevant to: ${item.visual_description}. Lighting: Soft, warm, natural, human-centric, not cold or clinical. Colors in background should be muted, premium, and sophisticated (no bold or garish colors). Design: Overlaying the image is a semi-transparent (80% opacity), premium horizontal text strip or box with a smooth gradient background (fading from Bold Fuschia to Deep Purple). The background image should be faintly visible through the gradient strip. Text: "${item.hook_text}" is written clearly in White, modern sans-serif font inside this gradient strip. Style: Nano Banana Pro premium aesthetic, Luxurious, soft glows, elegant gradients, high-contrast text block, minimalist.`;
                }
                
                // UPDATED: Using imagen-3.0 which is more widely supported/stable than 4.0
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${currentKey}`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                        instances: [{ prompt: enhancedPrompt }],
                        parameters: { sampleCount: 1 }
                        }),
                    });

                    if (!response.ok) {
                        // Capture and display the specific error from Google
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const base64Image = result.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${base64Image}`;
                    
                    setGeneratedImages(prev => ({ ...prev, [key]: imageUrl }));
                } catch (err) {
                    console.error("Error generating image:", err);
                    // Show the specific error message to the user
                    setError(`Image Generation Failed: ${err.message}`);
                } finally {
                    setGeneratingImages(prev => ({ ...prev, [key]: false }));
                }
            };

            const copyToClipboard = (text, sectionId) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopiedSection(sectionId);
                    setTimeout(() => setCopiedSection(null), 2000);
                } catch (err) { console.error('Failed to copy', err); }
                document.body.removeChild(textArea);
            };

            const MarkdownRenderer = ({ content }) => {
                if (!content) return null;
                return (
                    <div className="prose prose-slate max-w-none">
                        {content.split('\n').map((line, idx) => {
                            if (line.startsWith('### ')) return <h3 key={idx} className="text-xl font-bold mt-4 mb-2 text-slate-800">{line.replace('### ', '')}</h3>;
                            if (line.startsWith('## ')) return <h2 key={idx} className="text-2xl font-bold mt-6 mb-3 text-slate-800">{line.replace('## ', '')}</h2>;
                            if (line.startsWith('# ')) return <h1 key={idx} className="text-3xl font-bold mt-6 mb-4 text-slate-900">{line.replace('# ', '')}</h1>;
                            if (line.startsWith('- ')) return <li key={idx} className="ml-4 text-slate-700 mb-1">{line.replace('- ', '')}</li>;
                            if (line.trim() === '') return <br key={idx} />;
                            return <p key={idx} className="mb-3 text-slate-700 leading-relaxed">{line}</p>;
                        })}
                    </div>
                );
            };

            // Helpers
            const getCaptions = () => {
                if (!output?.captions) return [];
                if (typeof output.captions[0] === 'string') {
                    return output.captions.map(text => ({ 
                        hook_text: "Visual Hook Here", 
                        visual_description: "Minimalist background",
                        caption: text 
                    }));
                }
                if (output.captions[0].text && !output.captions[0].caption) {
                    return output.captions.map(item => ({
                        hook_text: "Visual Hook Here",
                        visual_description: item.image_prompt || "Minimalist background",
                        caption: item.text
                    }));
                }
                return output.captions;
            };

            const getEmailContent = () => output?.email;
            const getSubstackContent = () => output?.substack_notes;
            const getScriptContent = () => output?.script ? (typeof output.script === 'string' ? output.script : output.script.content) : '';
            const getScriptTitles = () => output?.script?.titles || [];

            if (showKeyInput) {
                return (
                    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center">
                            <div className="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Key className="w-8 h-8 text-indigo-600" />
                            </div>
                            <h2 className="text-2xl font-bold text-slate-900 mb-2">Enter API Key</h2>
                            <p className="text-slate-500 mb-6 text-sm">
                                To use this app, please enter your Google Gemini API Key. It will be stored locally in your browser.
                            </p>
                            <input 
                                type="password" 
                                placeholder="Paste API Key here..."
                                className="w-full p-3 border border-slate-300 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500 outline-none"
                                value={userApiKey}
                                onChange={(e) => setUserApiKey(e.target.value)}
                            />
                            <button 
                                onClick={() => saveApiKey(userApiKey)}
                                disabled={!userApiKey.trim()}
                                className="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition disabled:opacity-50"
                            >
                                Start Repurposing
                            </button>
                            <p className="mt-4 text-xs text-slate-400">
                                Don't have a key? <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-indigo-600 underline">Get one here</a>
                            </p>
                        </div>
                    </div>
                )
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 p-2 rounded-lg">
                                    <Sparkles className="w-5 h-5 text-white" />
                                </div>
                                <h1 className="text-xl font-bold text-slate-900 tracking-tight">Content Repurposer</h1>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-sm text-slate-500 hidden sm:block">
                                    LinkedIn â†’ Blog, IG, Video, Email, Substack
                                </div>
                                {!HARDCODED_KEY && (
                                    <button onClick={clearApiKey} className="text-xs text-slate-400 hover:text-red-500 underline">
                                        Reset Key
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            <div className="lg:col-span-5 space-y-4">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                                    <label htmlFor="post-input" className="block text-sm font-semibold text-slate-800 mb-2">
                                        Paste your LinkedIn Post
                                    </label>
                                    <textarea
                                        id="post-input"
                                        value={inputText}
                                        onChange={(e) => setInputText(e.target.value)}
                                        placeholder="Paste your content here..."
                                        className="w-full h-48 p-4 rounded-lg border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-slate-700 placeholder:text-slate-400 text-sm leading-relaxed"
                                    />

                                    <div className="mt-4">
                                        <label htmlFor="tweak-input" className="block text-sm font-semibold text-slate-800 mb-2 flex items-center gap-2">
                                            <SlidersHorizontal className="w-4 h-4 text-indigo-500" />
                                            Custom Instructions (Optional)
                                        </label>
                                        <input
                                            id="tweak-input"
                                            type="text"
                                            value={tweakPrompt}
                                            onChange={(e) => setTweakPrompt(e.target.value)}
                                            placeholder="e.g., Make it funnier, Focus on sales, Use emojis..."
                                            className="w-full p-3 rounded-lg border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-sm placeholder:text-slate-400"
                                        />
                                    </div>

                                    <div className="mt-6 flex items-center justify-between">
                                        <span className="text-xs text-slate-400">
                                            {inputText.length} characters
                                        </span>
                                        <button
                                            onClick={handleRepurpose}
                                            disabled={isLoading || !inputText.trim()}
                                            className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium text-sm transition-all
                                                ${isLoading || !inputText.trim() 
                                                ? 'bg-slate-100 text-slate-400 cursor-not-allowed' 
                                                : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-md hover:shadow-lg transform hover:-translate-y-0.5'
                                                }`}
                                        >
                                            {isLoading ? (
                                                <>
                                                    <Loader2 className="w-4 h-4 animate-spin" />
                                                    {output ? 'Regenerating...' : 'Generating...'}
                                                </>
                                            ) : (
                                                <>
                                                    <Sparkles className="w-4 h-4" />
                                                    {output ? 'Regenerate Assets' : 'Generate Assets'}
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-blue-50 rounded-xl p-4 border border-blue-100">
                                    <h3 className="text-sm font-semibold text-blue-900 mb-2">Configuration</h3>
                                    <ul className="space-y-2 text-xs text-blue-800">
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Readability Level: Grade 7</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> SEO Blog + Featured Image</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> 3 IG Posts (Hook Image + Caption)</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> 60s Reel Script + 5 Hooks</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Email Newsletter</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Substack: Community, Edu, Motivate</li>
                                    </ul>
                                </div>
                            </div>

                            <div className="lg:col-span-7">
                                {error && (
                                    <div className="bg-red-50 text-red-700 p-4 rounded-xl border border-red-100 flex items-start gap-3 mb-6">
                                        <AlertCircle className="w-5 h-5 flex-shrink-0 mt-0.5" />
                                        <div className="text-sm">{error}</div>
                                    </div>
                                )}

                                {!output && !isLoading && !error && (
                                    <div className="h-full min-h-[400px] flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50">
                                        <div className="w-16 h-16 bg-white rounded-full shadow-sm flex items-center justify-center mb-4">
                                            <FileText className="w-8 h-8 text-slate-300" />
                                        </div>
                                        <p className="text-sm font-medium">Ready to repurpose content</p>
                                        <p className="text-xs mt-1">Paste your text on the left to get started</p>
                                    </div>
                                )}

                                {output && (
                                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full max-h-[calc(100vh-140px)]">
                                        <div className="flex border-b border-slate-200 bg-slate-50/50 overflow-x-auto">
                                            {['blog', 'captions', 'script', 'email', 'substack'].map(tab => (
                                                <button
                                                    key={tab}
                                                    onClick={() => setActiveTab(tab)}
                                                    className={`flex-1 min-w-[80px] flex items-center justify-center gap-2 py-4 text-sm font-medium transition-colors border-b-2 capitalize ${
                                                        activeTab === tab 
                                                        ? 'border-indigo-600 text-indigo-600 bg-white' 
                                                        : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-100'
                                                    }`}
                                                >
                                                    {tab === 'captions' ? 'Visuals' : tab === 'script' ? 'Reel' : tab}
                                                </button>
                                            ))}
                                        </div>

                                        <div className="flex-1 overflow-y-auto p-6 bg-white custom-scrollbar">
                                            
                                            {activeTab === 'blog' && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="bg-white rounded-lg p-4 border border-slate-200 shadow-sm mb-6">
                                                        <div className="flex items-center justify-between mb-3">
                                                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                                <ImageIcon className="w-4 h-4 text-indigo-500" />
                                                                Featured Image
                                                            </h4>
                                                            {!generatedImages['blog'] && (
                                                                <button
                                                                    onClick={() => generateImage(output.blog, null, 'blog')}
                                                                    disabled={generatingImages['blog']}
                                                                    className="text-xs flex items-center gap-1.5 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md transition-all shadow-sm disabled:opacity-50"
                                                                >
                                                                    {generatingImages['blog'] ? <Loader2 className="w-3 h-3 animate-spin" /> : <Sparkles className="w-3 h-3" />}
                                                                    {generatingImages['blog'] ? 'Creating...' : 'Generate Image'}
                                                                </button>
                                                            )}
                                                        </div>

                                                        {generatedImages['blog'] ? (
                                                            <div className="relative group rounded-lg overflow-hidden border border-slate-100">
                                                                <img src={generatedImages['blog']} alt="Blog Featured" className="w-full h-auto object-cover max-h-[300px]" />
                                                                <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                                                    <a href={generatedImages['blog']} download="blog-featured.png" className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Download className="w-4 h-4" /> Download</a>
                                                                    <button onClick={() => generateImage(output.blog, null, 'blog')} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Sparkles className="w-4 h-4" /> Regenerate</button>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <div className="text-xs text-slate-600 bg-slate-50 p-3 rounded border border-slate-100 italic">
                                                                Suggested Concept: "{output.blog.visual_description || 'Professional landscape.'}"
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="flex items-start justify-between gap-4">
                                                        <div>
                                                            <span className="inline-block px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded mb-2">SEO Optimized</span>
                                                            <h2 className="text-2xl font-bold text-slate-900 leading-tight">{output.blog.title}</h2>
                                                        </div>
                                                        <button onClick={() => copyToClipboard(`# ${output.blog.title}\n\n${output.blog.content}`, 'blog')} className="flex-shrink-0 p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                                                            {copiedSection === 'blog' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}
                                                        </button>
                                                    </div>
                                                    <div className="border-t border-slate-100 pt-6">
                                                        <MarkdownRenderer content={output.blog.content} />
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'captions' && (
                                                <div className="space-y-8 animate-fadeIn">
                                                    {getCaptions().map((item, idx) => (
                                                        <div key={idx} className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                                                            <div className="bg-white rounded-lg p-4 border border-slate-200 shadow-sm mb-6">
                                                                <div className="flex items-center justify-between mb-3">
                                                                    <h4 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2"><ImageIcon className="w-4 h-4 text-indigo-500" /> Image Concept</h4>
                                                                    {!generatedImages[idx] && (
                                                                        <button onClick={() => generateImage(item, idx)} disabled={generatingImages[idx]} className="text-xs flex items-center gap-1.5 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md transition-all shadow-sm disabled:opacity-50">
                                                                            {generatingImages[idx] ? <Loader2 className="w-3 h-3 animate-spin" /> : <Sparkles className="w-3 h-3" />}
                                                                            {generatingImages[idx] ? 'Rendering...' : 'Generate Image'}
                                                                        </button>
                                                                    )}
                                                                </div>
                                                                {generatedImages[idx] ? (
                                                                    <div className="relative group rounded-lg overflow-hidden border border-slate-100">
                                                                        <img src={generatedImages[idx]} alt="AI Generated" className="w-full h-auto object-cover max-h-[300px]" />
                                                                        <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                                                            <a href={generatedImages[idx]} download={`visual-idea-${idx+1}.png`} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Download className="w-4 h-4" /> Download</a>
                                                                            <button onClick={() => generateImage(item, idx)} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Sparkles className="w-4 h-4" /> Regenerate</button>
                                                                        </div>
                                                                    </div>
                                                                ) : (
                                                                    <div className="space-y-3">
                                                                        <div className="flex items-start gap-2 text-sm text-slate-700 font-medium bg-indigo-50/50 p-3 rounded border border-indigo-100">
                                                                            <Type className="w-4 h-4 mt-0.5 text-indigo-500 flex-shrink-0" /><span>"{item.hook_text}"</span>
                                                                        </div>
                                                                        <div className="text-xs text-slate-500 italic pl-1">Background: {item.visual_description}</div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="relative group">
                                                                <div className="absolute top-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <button onClick={() => copyToClipboard(item.caption, `caption-${idx}`)} className="p-1.5 bg-white text-slate-400 hover:text-indigo-600 hover:shadow-sm rounded-lg border border-slate-200">
                                                                        {copiedSection === `caption-${idx}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                                                    </button>
                                                                </div>
                                                                <div className="flex items-center gap-2 mb-3">
                                                                    <span className="w-6 h-6 flex items-center justify-center bg-slate-100 text-slate-600 text-xs font-bold rounded-full">{idx + 1}</span>
                                                                    <span className="text-xs font-medium text-slate-500 uppercase tracking-wide">Caption</span>
                                                                </div>
                                                                <p className="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">{item.caption}</p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}

                                            {activeTab === 'script' && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="bg-indigo-50/50 rounded-xl p-5 border border-indigo-100 mb-6">
                                                        <h3 className="text-xs font-bold text-indigo-900 uppercase tracking-wider mb-3 flex items-center gap-2"><MonitorPlay className="w-4 h-4" /> Viral Hooks</h3>
                                                        <ul className="space-y-2">
                                                            {getScriptTitles().map((title, i) => (
                                                                <li key={i} className="flex items-center justify-between group bg-white p-3 rounded-lg border border-indigo-100 shadow-sm hover:shadow-md transition-all">
                                                                    <span className="text-slate-700 font-medium text-sm pr-4">{title}</span>
                                                                    <button onClick={() => copyToClipboard(title, `title-${i}`)} className="text-slate-400 hover:text-indigo-600 p-1 flex-shrink-0">{copiedSection === `title-${i}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}</button>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                    <div className="flex items-center justify-between mb-4">
                                                        <div><h3 className="text-lg font-semibold text-slate-900">Reel Script (60s)</h3></div>
                                                        <button onClick={() => copyToClipboard(getScriptContent(), 'script')} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">{copiedSection === 'script' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}</button>
                                                    </div>
                                                    <div className="bg-slate-900 text-slate-100 rounded-xl p-8 font-mono text-sm leading-loose shadow-inner whitespace-pre-wrap">{getScriptContent()}</div>
                                                </div>
                                            )}

                                            {activeTab === 'email' && getEmailContent() && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="flex items-center justify-between mb-4">
                                                        <h3 className="text-lg font-semibold text-slate-900">Email Newsletter</h3>
                                                        <button onClick={() => copyToClipboard(`Subject: ${getEmailContent().subject}\n\n${getEmailContent().body}`, 'email')} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">{copiedSection === 'email' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}</button>
                                                    </div>
                                                    <div className="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                                                        <div className="bg-slate-50 px-6 py-4 border-b border-slate-100">
                                                            <div className="mb-3"><span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Subject</span><div className="text-slate-900 font-medium text-lg mt-1">{getEmailContent().subject}</div></div>
                                                            <div><span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Preview</span><div className="text-slate-600 text-sm mt-1">{getEmailContent().preview_text}</div></div>
                                                        </div>
                                                        <div className="p-8 prose prose-slate max-w-none text-slate-700 whitespace-pre-wrap">{getEmailContent().body}</div>
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'substack' && getSubstackContent() && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <h3 className="text-lg font-semibold text-slate-900 mb-4">Substack Notes</h3>
                                                    {[
                                                        { type: 'Type 1', title: 'Community Note', color: 'purple', content: getSubstackContent().community, id: 'sub-comm' },
                                                        { type: 'Type 2', title: 'Educational Note', color: 'blue', content: getSubstackContent().educational, id: 'sub-edu' },
                                                        { type: 'Type 3', title: 'Motivational Note', color: 'amber', content: getSubstackContent().motivational, id: 'sub-mot' }
                                                    ].map(note => (
                                                        <div key={note.id} className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                                                            <div className="flex items-center justify-between mb-3">
                                                                <div className="flex items-center gap-2">
                                                                    <span className={`bg-${note.color}-100 text-${note.color}-700 text-xs font-bold px-2 py-1 rounded`}>{note.type}</span>
                                                                    <h4 className="font-bold text-slate-800">{note.title}</h4>
                                                                </div>
                                                                <button onClick={() => copyToClipboard(note.content, note.id)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                                                                    {copiedSection === note.id ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                                                </button>
                                                            </div>
                                                            <div className="bg-slate-50 p-4 rounded-lg border border-slate-100 text-slate-800 text-sm leading-relaxed whitespace-pre-wrap">{note.content}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<ContentRepurposer />);
    </script>
</body>
</html>
