// Nano Banana Pro Fallback Graphic Component - PREMIUM PHOTO STYLE
            const FallbackGraphic = ({ title, type, index }) => {
                // Deterministic background images based on index to ensure variety
                const backgrounds = [
                    "https://images.unsplash.com/photo-1497366216548-37526070297c?q=80&w=1200&auto=format&fit=crop", // Office
                    "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1200&auto=format&fit=crop", // Meeting
                    "https://images.unsplash.com/photo-1600880292203-757bb62b4baf?q=80&w=1200&auto=format&fit=crop", // Team
                    "https://images.unsplash.com/photo-1522071820081-009f0129c71c?q=80&w=1200&auto=format&fit=crop", // Collab
                    "https://images.unsplash.com/photo-1507679799987-c73779587ccf?q=80&w=1200&auto=format&fit=crop"  // Business
                ];
                
                const bgImage = backgrounds[index % backgrounds.length];

                return (
                    <div className={`relative overflow-hidden w-full flex flex-col items-center justify-center text-center ${type === 'blog' ? 'aspect-video' : 'aspect-square'} bg-slate-900 group`}>
                        {/* Background Image */}
                        <img 
                            src={bgImage} 
                            alt="Background" 
                            className="absolute inset-0 w-full h-full object-cover opacity-90 group-hover:scale-105 transition-transform duration-700 ease-out"
                        />
                        
                        {/* Subtle Dark Overlay for contrast */}
                        <div className="absolute inset-0 bg-black/20"></div>

                        {/* Nano Banana Pro Gradient Strip */}
                        <div className="relative z-10 w-full flex justify-center items-center">
                            <div className="w-full bg-gradient-to-r from-[rgba(217,70,239,0.9)] to-[rgba(109,40,217,0.9)] backdrop-blur-sm py-8 px-6 shadow-xl transform transition-all hover:scale-[1.02]">
                                <h3 className="text-white text-xl md:text-3xl font-bold font-display leading-tight tracking-tight drop-shadow-md max-w-2xl mx-auto">
                                    {title}
                                </h3>
                            </div>
                        </div>
                        
                        <div className="absolute bottom-4 right-4 text-white/60 text-[10px] font-mono uppercase tracking-widest z-20 bg-black/20 px-2 py-1 rounded">Nano Banana Pro</div>
                    </div>
                );
            };

            const getCaptions = () => {
                if (!output?.captions) return [];
                if (typeof output.captions[0] === 'string') {
                    return output.captions.map(text => ({ 
                        hook_text: "Visual Hook Here", 
                        visual_description: "Minimalist background",
                        caption: text 
                    }));
                }
                if (output.captions[0].text && !output.captions[0].caption) {
                    return output.captions.map(item => ({
                        hook_text: "Visual Hook Here",
                        visual_description: item.image_prompt || "Minimalist background",
                        caption: item.text
                    }));
                }
                return output.captions;
            };

            const getEmailContent = () => output?.email;
            const getSubstackContent = () => output?.substack_notes;
            const getScriptContent = () => output?.script ? (typeof output.script === 'string' ? output.script : output.script.content) : '';
            const getScriptTitles = () => output?.script?.titles || [];

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 p-2 rounded-lg">
                                    <Sparkles className="w-5 h-5 text-white" />
                                </div>
                                <h1 className="text-xl font-bold text-slate-900 tracking-tight">Content Repurposer</h1>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-sm text-slate-500 hidden sm:block">
                                    LinkedIn â†’ Blog, IG, Video, Email, Substack
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            <div className="lg:col-span-5 space-y-4">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                                    <label htmlFor="post-input" className="block text-sm font-semibold text-slate-800 mb-2">
                                        Paste your LinkedIn Post
                                    </label>
                                    <textarea
                                        id="post-input"
                                        value={inputText}
                                        onChange={(e) => setInputText(e.target.value)}
                                        placeholder="Paste your content here..."
                                        className="w-full h-48 p-4 rounded-lg border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-slate-700 placeholder:text-slate-400 text-sm leading-relaxed"
                                    />

                                    <div className="mt-4">
                                        <label htmlFor="tweak-input" className="block text-sm font-semibold text-slate-800 mb-2 flex items-center gap-2">
                                            <SlidersHorizontal className="w-4 h-4 text-indigo-500" />
                                            Custom Instructions (Optional)
                                        </label>
                                        <input
                                            id="tweak-input"
                                            type="text"
                                            value={tweakPrompt}
                                            onChange={(e) => setTweakPrompt(e.target.value)}
                                            placeholder="e.g., Make it funnier, Focus on sales, Use emojis..."
                                            className="w-full p-3 rounded-lg border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-sm placeholder:text-slate-400"
                                        />
                                    </div>

                                    <div className="mt-6 flex items-center justify-between">
                                        <span className="text-xs text-slate-400">
                                            {inputText.length} characters
                                        </span>
                                        <button
                                            onClick={handleRepurpose}
                                            disabled={isLoading || !inputText.trim()}
                                            className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium text-sm transition-all
                                                ${isLoading || !inputText.trim() 
                                                ? 'bg-slate-100 text-slate-400 cursor-not-allowed' 
                                                : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-md hover:shadow-lg transform hover:-translate-y-0.5'
                                                }`}
                                        >
                                            {isLoading ? (
                                                <>
                                                    <Loader2 className="w-4 h-4 animate-spin" />
                                                    {output ? 'Regenerating...' : 'Generating...'}
                                                </>
                                            ) : (
                                                <>
                                                    <Sparkles className="w-4 h-4" />
                                                    {output ? 'Regenerate Assets' : 'Generate Assets'}
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-blue-50 rounded-xl p-4 border border-blue-100">
                                    <h3 className="text-sm font-semibold text-blue-900 mb-2">Configuration</h3>
                                    <ul className="space-y-2 text-xs text-blue-800">
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Readability Level: Grade 7</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> SEO Blog + Featured Image</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> 3 IG Posts (Hook Image + Caption)</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> 60s Reel Script + 5 Hooks</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Email Newsletter</li>
                                        <li className="flex items-center gap-2"><Check className="w-3 h-3" /> Substack: Community, Edu, Motivate</li>
                                    </ul>
                                </div>
                            </div>

                            <div className="lg:col-span-7">
                                {error && (
                                    <div className="bg-red-50 text-red-700 p-4 rounded-xl border border-red-100 flex items-start gap-3 mb-6">
                                        <AlertCircle className="w-5 h-5 flex-shrink-0 mt-0.5" />
                                        <div className="text-sm">{error}</div>
                                    </div>
                                )}

                                {!output && !isLoading && !error && (
                                    <div className="h-full min-h-[400px] flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50">
                                        <div className="w-16 h-16 bg-white rounded-full shadow-sm flex items-center justify-center mb-4">
                                            <FileText className="w-8 h-8 text-slate-300" />
                                        </div>
                                        <p className="text-sm font-medium">Ready to repurpose content</p>
                                        <p className="text-xs mt-1">Paste your text on the left to get started</p>
                                    </div>
                                )}

                                {output && (
                                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full max-h-[calc(100vh-140px)]">
                                        <div className="flex border-b border-slate-200 bg-slate-50/50 overflow-x-auto">
                                            {['blog', 'captions', 'script', 'email', 'substack'].map(tab => (
                                                <button
                                                    key={tab}
                                                    onClick={() => setActiveTab(tab)}
                                                    className={`flex-1 min-w-[80px] flex items-center justify-center gap-2 py-4 text-sm font-medium transition-colors border-b-2 capitalize ${
                                                        activeTab === tab 
                                                        ? 'border-indigo-600 text-indigo-600 bg-white' 
                                                        : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-100'
                                                    }`}
                                                >
                                                    {tab === 'captions' ? 'Visuals' : tab === 'script' ? 'Reel' : tab}
                                                </button>
                                            ))}
                                        </div>

                                        <div className="flex-1 overflow-y-auto p-6 bg-white custom-scrollbar">
                                            
                                            {activeTab === 'blog' && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="bg-white rounded-lg p-4 border border-slate-200 shadow-sm mb-6">
                                                        <div className="flex items-center justify-between mb-3">
                                                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                                <ImageIcon className="w-4 h-4 text-indigo-500" />
                                                                Featured Image
                                                            </h4>
                                                            {!generatedImages['blog'] && (
                                                                <button
                                                                    onClick={() => generateImage(output.blog, null, 'blog')}
                                                                    disabled={generatingImages['blog']}
                                                                    className="text-xs flex items-center gap-1.5 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md transition-all shadow-sm disabled:opacity-50"
                                                                >
                                                                    {generatingImages['blog'] ? <Loader2 className="w-3 h-3 animate-spin" /> : <Sparkles className="w-3 h-3" />}
                                                                    {generatingImages['blog'] ? 'Creating...' : 'Generate Image'}
                                                                </button>
                                                            )}
                                                        </div>

                                                        {generatedImages['blog'] === 'error_fallback' ? (
                                                            <FallbackGraphic title={output.blog.title} type="blog" index={0} />
                                                        ) : generatedImages['blog'] ? (
                                                            <div className="relative group rounded-lg overflow-hidden border border-slate-100">
                                                                <img src={generatedImages['blog']} alt="Blog Featured" className="w-full h-auto object-cover max-h-[300px]" />
                                                                <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                                                    <a href={generatedImages['blog']} download="blog-featured.png" className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Download className="w-4 h-4" /> Download</a>
                                                                    <button onClick={() => generateImage(output.blog, null, 'blog')} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Sparkles className="w-4 h-4" /> Regenerate</button>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <div className="text-xs text-slate-600 bg-slate-50 p-3 rounded border border-slate-100 italic">
                                                                Suggested Concept: "{output.blog.visual_description || 'Professional landscape.'}"
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="flex items-start justify-between gap-4">
                                                        <div>
                                                            <span className="inline-block px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded mb-2">SEO Optimized</span>
                                                            <h2 className="text-2xl font-bold text-slate-900 leading-tight">{output.blog.title}</h2>
                                                        </div>
                                                        <button onClick={() => copyToClipboard(`# ${output.blog.title}\n\n${output.blog.content}`, 'blog')} className="flex-shrink-0 p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                                                            {copiedSection === 'blog' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}
                                                        </button>
                                                    </div>
                                                    <div className="border-t border-slate-100 pt-6">
                                                        <MarkdownRenderer content={output.blog.content} />
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'captions' && (
                                                <div className="space-y-8 animate-fadeIn">
                                                    {getCaptions().map((item, idx) => (
                                                        <div key={idx} className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                                                            <div className="bg-white rounded-lg p-4 border border-slate-200 shadow-sm mb-6">
                                                                <div className="flex items-center justify-between mb-3">
                                                                    <h4 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2"><ImageIcon className="w-4 h-4 text-indigo-500" /> Image Concept</h4>
                                                                    {!generatedImages[idx] && (
                                                                        <button onClick={() => generateImage(item, idx)} disabled={generatingImages[idx]} className="text-xs flex items-center gap-1.5 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-md transition-all shadow-sm disabled:opacity-50">
                                                                            {generatingImages[idx] ? <Loader2 className="w-3 h-3 animate-spin" /> : <Sparkles className="w-3 h-3" />}
                                                                            {generatingImages[idx] ? 'Rendering...' : 'Generate Image'}
                                                                        </button>
                                                                    )}
                                                                </div>
                                                                {generatedImages[idx] === 'error_fallback' ? (
                                                                    <FallbackGraphic title={item.hook_text} type="social" index={idx} />
                                                                ) : generatedImages[idx] ? (
                                                                    <div className="relative group rounded-lg overflow-hidden border border-slate-100">
                                                                        <img src={generatedImages[idx]} alt="AI Generated" className="w-full h-auto object-cover max-h-[300px]" />
                                                                        <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                                                            <a href={generatedImages[idx]} download={`visual-idea-${idx+1}.png`} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Download className="w-4 h-4" /> Download</a>
                                                                            <button onClick={() => generateImage(item, idx)} className="bg-white/90 text-slate-900 px-3 py-2 rounded-lg text-xs font-medium hover:bg-white flex items-center gap-2"><Sparkles className="w-4 h-4" /> Regenerate</button>
                                                                        </div>
                                                                    </div>
                                                                ) : (
                                                                    <div className="space-y-3">
                                                                        <div className="flex items-start gap-2 text-sm text-slate-700 font-medium bg-indigo-50/50 p-3 rounded border border-indigo-100">
                                                                            <Type className="w-4 h-4 mt-0.5 text-indigo-500 flex-shrink-0" /><span>"{item.hook_text}"</span>
                                                                        </div>
                                                                        <div className="text-xs text-slate-500 italic pl-1">Background: {item.visual_description}</div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="relative group">
                                                                <div className="absolute top-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <button onClick={() => copyToClipboard(item.caption, `caption-${idx}`)} className="p-1.5 bg-white text-slate-400 hover:text-indigo-600 hover:shadow-sm rounded-lg border border-slate-200">
                                                                        {copiedSection === `caption-${idx}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                                                    </button>
                                                                </div>
                                                                <div className="flex items-center gap-2 mb-3">
                                                                    <span className="w-6 h-6 flex items-center justify-center bg-slate-100 text-slate-600 text-xs font-bold rounded-full">{idx + 1}</span>
                                                                    <span className="text-xs font-medium text-slate-500 uppercase tracking-wide">Caption</span>
                                                                </div>
                                                                <p className="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">{item.caption}</p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}

                                            {activeTab === 'script' && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="bg-indigo-50/50 rounded-xl p-5 border border-indigo-100 mb-6">
                                                        <h3 className="text-xs font-bold text-indigo-900 uppercase tracking-wider mb-3 flex items-center gap-2"><MonitorPlay className="w-4 h-4" /> Viral Hooks</h3>
                                                        <ul className="space-y-2">
                                                            {getScriptTitles().map((title, i) => (
                                                                <li key={i} className="flex items-center justify-between group bg-white p-3 rounded-lg border border-indigo-100 shadow-sm hover:shadow-md transition-all">
                                                                    <span className="text-slate-700 font-medium text-sm pr-4">{title}</span>
                                                                    <button onClick={() => copyToClipboard(title, `title-${i}`)} className="text-slate-400 hover:text-indigo-600 p-1 flex-shrink-0">{copiedSection === `title-${i}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}</button>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                    <div className="flex items-center justify-between mb-4">
                                                        <div><h3 className="text-lg font-semibold text-slate-900">Reel Script (60s)</h3></div>
                                                        <button onClick={() => copyToClipboard(getScriptContent(), 'script')} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">{copiedSection === 'script' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}</button>
                                                    </div>
                                                    <div className="bg-slate-900 text-slate-100 rounded-xl p-8 font-mono text-sm leading-loose shadow-inner whitespace-pre-wrap">{getScriptContent()}</div>
                                                </div>
                                            )}

                                            {activeTab === 'email' && getEmailContent() && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <div className="flex items-center justify-between mb-4">
                                                        <h3 className="text-lg font-semibold text-slate-900">Email Newsletter</h3>
                                                        <button onClick={() => copyToClipboard(`Subject: ${getEmailContent().subject}\n\n${getEmailContent().body}`, 'email')} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">{copiedSection === 'email' ? <Check className="w-5 h-5 text-green-500" /> : <Copy className="w-5 h-5" />}</button>
                                                    </div>
                                                    <div className="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                                                        <div className="bg-slate-50 px-6 py-4 border-b border-slate-100">
                                                            <div className="mb-3"><span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Subject</span><div className="text-slate-900 font-medium text-lg mt-1">{getEmailContent().subject}</div></div>
                                                            <div><span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Preview</span><div className="text-slate-600 text-sm mt-1">{getEmailContent().preview_text}</div></div>
                                                        </div>
                                                        <div className="p-8 prose prose-slate max-w-none text-slate-700 whitespace-pre-wrap">{getEmailContent().body}</div>
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'substack' && getSubstackContent() && (
                                                <div className="space-y-6 animate-fadeIn">
                                                    <h3 className="text-lg font-semibold text-slate-900 mb-4">Substack Notes</h3>
                                                    {[
                                                        { type: 'Type 1', title: 'Community Note', color: 'purple', content: getSubstackContent().community, id: 'sub-comm' },
                                                        { type: 'Type 2', title: 'Educational Note', color: 'blue', content: getSubstackContent().educational, id: 'sub-edu' },
                                                        { type: 'Type 3', title: 'Motivational Note', color: 'amber', content: getSubstackContent().motivational, id: 'sub-mot' }
                                                    ].map(note => (
                                                        <div key={note.id} className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                                                            <div className="flex items-center justify-between mb-3">
                                                                <div className="flex items-center gap-2">
                                                                    <span className={`bg-${note.color}-100 text-${note.color}-700 text-xs font-bold px-2 py-1 rounded`}>{note.type}</span>
                                                                    <h4 className="font-bold text-slate-800">{note.title}</h4>
                                                                </div>
                                                                <button onClick={() => copyToClipboard(note.content, note.id)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors">
                                                                    {copiedSection === note.id ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                                                </button>
                                                            </div>
                                                            <div className="bg-slate-50 p-4 rounded-lg border border-slate-100 text-slate-800 text-sm leading-relaxed whitespace-pre-wrap">{note.content}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };
